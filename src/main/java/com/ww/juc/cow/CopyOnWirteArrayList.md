# CopyOnWriteArrayList

## 特性
* 1）支持高效率并发并且线程安全，读操作无锁ArrayList，所有可变操作都是通过对底层数组进行一次新的复制来实现；
* 2）适合使用在读多写少的场景；

## 缺点

* 1）由于每次写操作，都需要拷贝数组，会消耗内存，在原数组的内容比较多的情况下，可能会导致gc；
* 2）不能用于实时读的场景，像拷贝数组、新增元素都需要时间，所有调用一个set操作后，读取到数据可能还是旧的，CopyOnWriteArrayList做到最终一致性，没办法满足实时性要求；

## 原理

CopyOnWriteArrayList是一个ArrayList的线程安全版本，原理大概可以理解为：初始化的时候只有一个容器，很长一段时间，这个容器的数据、数量都没有发生变化，多个线程都是读取同一个容器中的数据，所以这个时候每个线程读到的数据都是唯一、一致的。后来有线程往容器中添加新数据，这个时候CopyOnWriteArrayList底层会先copy出一个容器副本，再往新的容器里添加这个新数据，最后把新容器的引用地址替换之前旧容器引用地址。但是在添加这个数据的期间，如果其他线程去读数据，读取到的仍然是旧容器里的数据。